---
layout:       post  
title:        Pythonçˆ¬è™«ï¼šçˆ¬å–Bilibiliå£çº¸å–µçš„ç›¸å†Œå›¾ç‰‡  
subtitle:     ç®€å•çš„Pythonå›¾ç‰‡çˆ¬å–ï¼Œè°¢è°¢ä½ ï¼Œå£çº¸å–µ   
date:         2023-05-12  
auther:       BlackDn  
header-img:   img/19mon5_06.jpg  
catalog:      true  
tags:    
    - Python  
    - Crawler  
---

> "æœªæ›¾è¯•å›¾æ‘˜æ˜Ÿæ§æœˆï¼Œä½†æœŸæœ›æœˆäº®å¥”æˆ‘è€Œæ¥ã€‚"

# Pythonçˆ¬è™«ï¼šçˆ¬å–Bilibiliå£çº¸å–µçš„ç›¸å†Œå›¾ç‰‡

## å‰è¨€

**5121428é»˜å“€**ï¼ŒRIPğŸ•¯ï¸  
ä¹‹å‰æˆ‘ä»¬åœ¨[Pythonçˆ¬è™«å…¥é—¨ï¼šçˆ¬å–è‡ªå·±çš„åšå®¢æ–‡æœ¬](https://blackdn.github.io/2023/04/23/Python-Crawler-Intro-2023/)ä¸­çˆ¬å–äº†æ–‡æœ¬ï¼Œç°åœ¨æ¥çˆ¬ä¸€çˆ¬å›¾ç‰‡ã€‚  
ç›®æ ‡æ˜¯**Bilibiliå®˜å·å£çº¸å–µ**çš„ç©ºé—´ç›¸å†Œä¸­çš„å›¾ç‰‡ï¼š[å£çº¸å–µçš„ç›¸å†Œç©ºé—´](https://space.bilibili.com/6823116/album)  

## çˆ¬å–æ–‡å­—å’Œå›¾ç‰‡çš„åŒºåˆ«

å›¾ç‰‡çš„è¯»å†™å’Œæ–‡æœ¬ä¸åŒï¼Œåœ¨Pythonä¸­è¿›è¡Œå›¾ç‰‡è¯»å†™çš„æ—¶å€™ï¼Œéœ€è¦è§„å®š`'b'`æ¥è¡¨ç¤º**äºŒè¿›åˆ¶æ¨¡å¼**ã€‚  
å…¶å®ç½‘ç»œä¼ è¾“å’Œå­˜å‚¨çš„æ—¶å€™ç”¨çš„éƒ½æ˜¯äºŒè¿›åˆ¶å•¦ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨ä¸€äº›è½¯ä»¶ï¼ˆæ¯”å¦‚`Notepad++`ï¼‰æ‰“å¼€å›¾ç‰‡æˆ–txtæ–‡ä»¶éƒ½å¯ä»¥çœ‹åˆ°å…¶**åå…­è¿›åˆ¶**çš„å†…å®¹ï¼ˆå› ä¸ºäºŒè¿›åˆ¶å¤ªé•¿äº†æ‰€ä»¥ä¼šè½¬æˆåå…­è¿›åˆ¶ï¼Œæœ¬èº«å†…å®¹æ˜¯ä¸€æ ·çš„ï¼‰  
å¾—ç›Šäºä¸åŒçš„æ–‡å­—æœ‰ç€å„ç§å„æ ·çš„ç¼–ç è§£ç ï¼ˆæ¯”å¦‚ASCIIç ï¼ŒBIG5ç ï¼ŒUnicodeç ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†äºŒè¿›åˆ¶å†…å®¹å˜ä¸ºæˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„å­—ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å°è¾“å‡ºçˆ¬å–åˆ°çš„å­—ç¬¦ï¼Œè€ŒéäºŒè¿›åˆ¶å†…å®¹ã€‚è¿™æ˜¯å› ä¸ºç³»ç»Ÿåœ¨ä¸­é—´æ‚„æ‚„åœ°å¸®æˆ‘ä»¬è¿›è¡Œäº†ç¼–ç è§£ç ï¼Œç„¶ååœ¨æ§åˆ¶å°è¿›è¡Œè¾“å‡ºã€‚

è‡ªç„¶ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½åœ¨å‘½ä»¤å°è¾“å‡ºå›¾ç‰‡çš„ã€‚å›¾ç‰‡æ–‡ä»¶ï¼ˆ`jpgã€pngã€webp`ï¼‰æœ‰ç€è‡ªå·±çš„æ ¼å¼ï¼Œæœ‰ç€å…¶æ‰€è§„å®šçš„æ–‡ä»¶å¤´æˆ–æ–‡ä»¶å°¾å•¥çš„ï¼Œå› æ­¤éœ€è¦é€šè¿‡ç‰¹å®šçš„è½¯ä»¶æ¥æ‰“å¼€æ–‡ä»¶ã€‚è¿™äº›è½¯ä»¶ä¼šæ ¹æ®è§„å®šçš„æ ¼å¼æ¥è·å–å›¾ç‰‡å¤§å°ã€é¢œè‰²ç­‰ä¿¡æ¯ï¼Œå¹¶å°†å…¶æ„å»ºå‡ºæˆ‘ä»¬çœ¼å‰çš„å›¾ç‰‡ï¼ˆè¿™äº›ä¿¡æ¯éƒ½åœ¨å›¾ç‰‡çš„äºŒè¿›åˆ¶å†…å®¹ä¸­ï¼‰ã€‚  
è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè®°äº‹æœ¬æˆ–æ§åˆ¶å°çœ‹ä¸äº†å›¾ç‰‡â€”â€”ä»–ä»¬ä¸ä¼šä»ä¸­è·å–è¿™äº›ä¿¡æ¯ï¼Œä¹Ÿä¸å­˜åœ¨ä»€ä¹ˆç¼–ç èƒ½å°†å›¾ç‰‡è¾“å‡ºï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ§åˆ¶å°è¾“å‡ºçš„åªèƒ½æ˜¯å…¶äºŒè¿›åˆ¶æœ¬ä½“ã€‚

è¯´äº†è¿™ä¹ˆå¤šæœ‰çš„æ²¡çš„ï¼Œå…¶å®å°±ä¸€å¥è¯ï¼Œæˆ‘ä»¬ä¸‹è½½å›¾ç‰‡çš„æ—¶å€™è¦ç”¨**äºŒè¿›åˆ¶æ¨¡å¼**ï¼Œå¹¶ä¸”è¿‡ç¨‹ä¸­æˆ‘ä»¬æ˜¯çœ‹ä¸åˆ°å›¾ç‰‡çš„æ ·å­çš„å˜ã€‚

## çŸ¥è¯†ç‚¹è¡¥å……

å…¶å®åªè¦ä¼šäº†ä¸Šä¸€ç¯‡å†…å®¹é‡Œæ¶‰åŠçš„çŸ¥è¯†å…¶å®å°±å·®ä¸å¤šäº†ï¼Œä¸è¿‡åœ¨çˆ¬å–çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å…¶å›¾ç‰‡çš„`url`å¹¶æ²¡æœ‰ç›´æ¥æ”¾åœ¨é¡µé¢ä¸Šï¼Œè€Œæ˜¯é€šè¿‡é¢å¤–å‘é€è¯·æ±‚æ¥è·å–çš„ã€‚è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª**JSONå¯¹è±¡**ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç”¨Pythonçš„**jsonåº“**å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œè€Œä¸éœ€è¦å¯¹é¡µé¢èŠ‚ç‚¹è¿›è¡Œæ“ä½œã€‚æ‰€ä»¥**BeautifulSoup**æš‚æ—¶å¤±å»äº†ç”¨æ­¦ä¹‹åœ°ï¼ŒPythonå†…ç½®çš„**jsonåº“**è¶æœºä¸Šä½ã€‚  

æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨è¯»å†™æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦ç”¨äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆ`b`ï¼‰è€Œä¸æ˜¯é»˜è®¤çš„æ–‡æœ¬æ¨¡å¼ï¼ˆ`t`ï¼‰ï¼Œæ¯•ç«Ÿæ˜¯å›¾ç‰‡å˜›ã€‚  
å‰©ä¸‹çš„éš¾ç‚¹é›†ä¸­åœ¨**å¯»æ‰¾url**å’Œ**åˆ†æè¿”å›ä½“ç»“æ„**ä¸Šï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢è¾¹åšè¾¹çœ‹ã€‚

### Pythonåˆ›å»ºæ–‡ä»¶

å¾ˆå¤šå°ä¼™ä¼´ä¸æƒ³æŠŠæˆ‘ä»¬çˆ¬å–åˆ°çš„æ–‡ç« æˆ–å›¾ç‰‡å…¨éƒ¨ä¸€è‚¡è„‘åœ°å †åœ¨æ ¹ç›®å½•ï¼ŒåŠ³èµ„å°±æ˜¯æƒ³è¦åˆ†ç±»ã€‚ä½†æ˜¯Pythonçš„`open()`æ–¹æ³•æ¥å—æ–‡ä»¶çš„æ—¶å€™å¦‚æœå‰ç¼€çš„æ–‡ä»¶å¤¹ä¸å­˜åœ¨æ˜¯ä¼šç›´æ¥æŠ¥é”™çš„ï¼Œä¸ä¼šä¸»åŠ¨ç»™å’±åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œè¿™æ—¶å€™å°±è¦ç”¨å…¶ä»–æ–¹æ³•å¸®åŠ©æˆ‘ä»¬åˆ›å»ºæ–‡ä»¶å¤¹äº†  
ä¸»è¦ç”¨åˆ°**osåŒ…**çš„è¿™ä¸‰ä¸ªæ–¹æ³•ï¼š
1. `os.path.exists(path)`ï¼šåˆ¤æ–­pathç›®å½•ï¼ˆæ–‡ä»¶å¤¹ï¼‰æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿”å›`True`
2. `os.mkdir(path)`ï¼šåˆ›å»ºæŒ‡å®šç›®å½•
3. `os.makedirs(path)`ï¼šåˆ›å»ºæŒ‡å®šå¤šå±‚ç›®å½•ï¼ˆæ–‡ä»¶å¤¹å’Œå­æ–‡ä»¶å¤¹ï¼‰

å› ä¸ºå¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œæˆ‘ä»¬å†åˆ›å»ºä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„ï¼ˆ`FileExistsError`ï¼‰ï¼Œæ‰€ä»¥é€šå¸¸ä¹ æƒ¯åœ¨åˆ›å»ºä¹‹å‰ç”¨`exists()`åˆ¤æ–­ä¸€ä¸‹  
å¦‚æœæˆ‘æƒ³åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª`image`çš„æ–‡ä»¶å¤¹ï¼š

```python
dir_path = 'image/'  
if not os.path.exists(dir_path):  
    os.mkdir(dir_path)
```

åˆå› ä¸ºå¦‚æœä¸Šçº§ç›®å½•ä¸å­˜åœ¨ï¼Œæ¯”å¦‚æˆ‘æƒ³åœ¨`image`æ–‡ä»¶å¤¹é‡Œåˆ›å»ºä¸€ä¸ª`background`æ–‡ä»¶å¤¹ï¼Œå³`image/background`ï¼Œä½†æ˜¯`image`ç›®å½•ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„ï¼ˆ`FileNotFoundError`ï¼‰ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°`makdirs()`äº†  
å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸¤ä¸ª`mkdir()`å…ˆåˆ›å»º`image`å†åˆ›å»º`background`ï¼Œä½†é‚£ä¹Ÿå¤ªä¸æ™ºèƒ½äº†ï¼Œä¸å¤Ÿä¼˜é›…;>

```python
dir_path = 'image/background/'
if not os.path.exists(dir_path):
	os.makedirs(dir_path)
```

æœ€åæä¸€å˜´ï¼Œ`mkdir()`å’Œ`makrdirs()`éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„å‚æ•°`mode`ï¼Œç”¨äºé…åˆ¶æˆ‘ä»¬åˆ›å»ºçš„ç›®å½•çš„æƒé™ï¼Œé»˜è®¤`mode=0o777`ï¼Œè¡¨ç¤º777æƒé™ï¼Œå³å¯è¯»å¯å†™å¯æ‰§è¡Œã€‚æƒé™åŠå…¶æ•°å€¼è¡¨ç¤ºå…·ä½“å¯è§[Linuxæƒé™åŠchmodå‘½ä»¤](https://blackdn.github.io/2020/03/29/Linux-Basic-Tool-2020/#linux%E6%9D%83%E9%99%90%E5%8F%8Achmod%E5%91%BD%E4%BB%A4)

### Pythonæ“ä½œJSONå¯¹è±¡ï¼šjsonåº“

å¯¹äºJSONå¯¹è±¡çš„æ“ä½œï¼ŒPythonè‡ªå¸¦äº†ä¸€ä¸ªå†…ç½®åº“`json`ï¼Œå…¶å®ä¸»è¦çš„å°±ä¸¤ä¸ªæ–¹æ³•ï¼Œç®€å•å¥½ç”¨ã€‚  
ï¼ˆå…¶å®åœ¨åé¢çš„ä¾‹å­ä¸­ç”¨ä¸åˆ°ï¼Œå› ä¸º**request**çš„`json()`æ–¹æ³•ç›´æ¥å¸®æˆ‘ä»¬è½¬äº†......ä½†è¿˜æ˜¯å¯ä»¥äº†è§£ä¸€ä¸‹çš„ï¼‰

`json.dump()`ç”¨äºå°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆ**JSONå¯¹è±¡ï¼ˆå­—ç¬¦ä¸²ï¼‰**ï¼Œå®ƒçš„å‚æ•°å¤ªå¤šäº†ï¼ŒåŠ ä¸Šé»˜è®¤å€¼å†™å‡ºæ¥å¾—å ä¸¤ä¸‰è¡Œæ‰€ä»¥å°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œåæ­£ä¹Ÿä¸ä¸€å®šéƒ½èƒ½ç”¨å¾—åˆ°ã€‚  
å…¶ä¸­æœ‰ä¸ªå‚æ•°`indent`ç”¨åˆ°çš„æ¯”è¾ƒå¤šï¼Œè¡¨ç¤ºåœ¨è¾“å‡ºçš„æ—¶å€™ä¼šè¿›è¡Œç¼©è¿›ä»è€Œç¾åŒ–è¾“å‡ºã€‚é»˜è®¤å€¼ä¸º`None`ï¼Œè¡¨ç¤ºç´§å‡‘è¾“å‡ºï¼ˆå°±æ˜¯ä¸æ¢è¡Œï¼‰ï¼›å¦‚æœæ˜¯éè´Ÿæ•´æ•°æˆ–è€…å­—ç¬¦ä¸²ï¼ˆå¦‚`\t`ï¼‰åˆ™ä¼šæŒ‰ç…§æ‰€ç»™å€¼å¯¹æ¯ä¸€å±‚è¿›è¡Œç¼©è¿›

```python
import json

data = {  
    'name': 'blackdn',  
    'age': 18,  
    'hobbies': {  
        'sports': 'running',  
        'food': 'hamburger'  
    },  
}  
json_data = json.dumps(data)  
print(json_data)
# {"name": "blackdn", "age": 18, "hobbies": {"sports": "running", "food": "hamburger"}}

json_data_with_indent = json.dumps(data, indent=4)  
print(json_data_with_indent)
'''
{
    "name": "blackdn",
    "age": 18,
    "hobbies": {
        "sports": "running",
        "food": "hamburger"
    }
}
'''
```

`json.loads()`åˆ™æ˜¯åè¿‡æ¥ï¼Œå¦‚æœæˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå¯ä»¥å°†å…¶è½¬ä¸ºä¸€ä¸ª**Pythonå¯¹è±¡ï¼ˆé”®å€¼å¯¹ï¼‰**ã€‚JSONçš„`key`å°±æ˜¯å¯¹è±¡çš„å±æ€§ï¼Œ`value`å°±æ˜¯å¯¹è±¡çš„å€¼

```python
object_data = json.loads(json_data)  
print(object_data)  
# {'name': 'blackdn', 'age': 18, 'hobbies': {'sports': 'running', 'food': 'hamburger'}}
print(object_data['name'])
# blackdn
```

## å°è¯•èº«æ‰‹

### å¯»è§…URL

å…ˆåˆ«æ€¥ç€å†™ä»£ç ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“çˆ¬è™«ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡`requests`è·å–æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—çŸ¥é“æˆ‘ä»¬è¦ä»å“ªé‡Œè·å–æƒ³è¦çš„ä¸œè¥¿â€”â€”è‡³å°‘å¾—å…ˆçœ‹çœ‹å›¾ç‰‡çš„urlåœ¨å“ªï¼Œé•¿å•¥æ ·

åœ¨ç©ºé—´çš„ç›¸å†Œé¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå›¾ç‰‡æŠ•ç¨¿åŒ…å«ä¸¤ä¸ªé“¾æ¥ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¦æƒ…é¡µçš„é“¾æ¥å’Œç¼©ç•¥å›¾çš„é“¾æ¥ï¼š

![album](https://s1.ax1x.com/2023/05/12/p9y2HIA.png)


æ˜¾ç„¶ï¼Œè¿™ä¸¤ä¸ªéƒ½ä¸èƒ½æ‹¿æ¥ç›´æ¥ç”¨ã€‚è¯¦æƒ…é¡µéœ€è¦å†ç‚¹è¿›å»æ‰¾å›¾ç‰‡çš„urlï¼Œè€Œç¼©ç•¥å›¾çš„åˆ†è¾¨ç‡å¾ˆä½ï¼Œæ— æ³•æ‹¿æ¥å½“å£çº¸æ¬£èµã€‚  
äºæ˜¯æˆ‘ä»¬é€€ä¸€æ­¥ï¼Œæƒ³æƒ³è¿™äº›å›¾ç‰‡æ˜¯å“ªæ¥çš„â€”â€”ä»€ä¹ˆæ—¶å€™ä¼šåŠ è½½è¿™äº›å›¾ç‰‡å‘¢ï¼Ÿè‡ªç„¶æ˜¯ç¿»é¡µçš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±æ¥çœ‹çœ‹ç¿»é¡µçš„æ—¶å€™è¿›è¡Œäº†ä»€ä¹ˆè¯·æ±‚ï¼š

![page](https://s1.ax1x.com/2023/05/12/p9y2LGt.png)

æˆ‘ä»¬å‘ç°ï¼Œå½“ç‚¹å‡»ç¿»é¡µçš„æ—¶å€™ï¼Œä¼šå‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå°†å½“å‰é¡µçš„æ‰€æœ‰å›¾ç‰‡ä¿¡æ¯éƒ½è¿”å›ã€‚è€Œä¸”ä»”ç»†è§‚å¯Ÿè¿™ä¸ªè¯·æ±‚ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»ä¸åŒæŒ‰é’®çš„æ—¶å€™ï¼Œå”¯ä¸€å˜åŒ–çš„å‚æ•°åªæœ‰`page_num`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªè¦æ§åˆ¶è¿™ä¸ªå‚æ•°ï¼Œå°±å¯ä»¥ç›´æ¥æ„å»ºurlï¼Œä¸éœ€è¦åœ¨é¡µé¢ä¸Šå¯»æ‰¾ï¼Œä¹Ÿä¸éœ€è¦ä¸€ä¸ªä¸€ä¸ªè¯¦æƒ…é¡µç‚¹è¿›å»äº†ã€‚  
è¦æ³¨æ„çš„æ˜¯ï¼Œç¿»é¡µçš„`page_num`å‚æ•°æ˜¯ä»`0`å¼€å§‹çš„ï¼Œå³ç¬¬ä¸€é¡µ`page_num = 0`ï¼Œç¬¬åé¡µ`page_num = 9`

### åˆ†æç»“æ„

æˆ‘ä»¬å…ˆçœ‹çœ‹è¯·æ±‚è¿”å›çš„æ˜¯å•¥ä¸œè¥¿ï¼š

```json
{
	"code":Â 0,
	"message":Â "0",
	"ttl":Â 1,
	"data":Â {
		"items":Â [...]
	}
}
```

æ˜¾ç„¶å…¶ä¸­åªæœ‰`data`æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œ`data`ä¸­åªæœ‰ä¸€ä¸ªåä¸º`items`çš„åˆ—è¡¨ï¼Œè€Œè¿™ä¸ªåˆ—è¡¨å°±å¯¹åº”ç€ç©ºé—´ç›¸å†Œå½“å‰é¡µçš„æ‰€æœ‰å›¾ç‰‡ä¿¡æ¯   
æˆ‘ä»¬å–å…¶ä¸­ä¸€ä¸ªå¯¹è±¡çœ‹çœ‹ï¼š

```json
[
	{
		"doc_id":Â 239076960,
		"poster_uid":Â 6823116,
		"title":Â "",
		"description":Â "èŠ‚æ—¥å¿«ä¹å“Ÿâ™ª(^âˆ‡^*)",
		"pictures":Â [
			{
				"img_src":Â "https://i0.hdslb.com/bfs/new_dyn/569b5f29ad35f49491002fbf335cf4226823116.png",
				"img_width":Â 1280,
				"img_height":Â 2560,
				"img_size":Â 2102.0810546875,
				"img_tags":Â null
			},
			{
				"img_src":Â "https://i0.hdslb.com/bfs/new_dyn/39b6f79b2e9e5cf9aa2664b62427167b6823116.png",
				"img_width":Â 1600,
				"img_height":Â 2560,
				"img_size":Â 2309.630859375,
				"img_tags":Â null
			},
			{
				"img_src":Â "https://i0.hdslb.com/bfs/new_dyn/245f633c93de035942c388958db68bcc6823116.png",
				"img_width":Â 2732,
				"img_height":Â 2048,
				"img_size":Â 3912.3623046875,
				"img_tags":Â null
			}
		],
		"count":Â 3,
		"ctime":Â 1682697606,
		"view":Â 96298,
		"like":Â 2463,
		"dyn_id":Â "789669268499202185"
	},
{...},
{...},
...
]
```

æ¯ä¸ª`item`éƒ½å¯¹åº”ç€ä¸€ä¸ªæŠ•ç¨¿ï¼Œå…¶åŒ…å«äº†`ç¨¿ä»¶idï¼ˆdoc_idï¼‰`ï¼Œ`ç”¨æˆ·idï¼ˆposter_uidï¼‰`ï¼Œ`æŠ•ç¨¿æ ‡é¢˜å’Œæ–‡å­—å†…å®¹ï¼ˆtitle / descriptionï¼‰`ï¼Œ`å›¾ç‰‡æ•°é‡ï¼ˆcountï¼‰`ï¼Œ`ç‚¹å‡»é‡ï¼ˆviewï¼‰`ï¼Œ`ç‚¹èµé‡ï¼ˆlikeï¼‰`ï¼Œ`æ—¶é—´æˆ³`ç­‰ã€‚  
å½“ç„¶è¿˜åŒ…æ‹¬æˆ‘ä»¬æ‰€éœ€çš„æ¯å¼ å›¾ç‰‡ä¿¡æ¯ï¼ˆ`pictures`ï¼‰ï¼Œå…¶åŒ…å«äº†`å›¾ç‰‡url`ï¼Œ`å›¾ç‰‡çš„é•¿å®½ï¼ˆimg_width / img_heightï¼‰`å’Œ`å¤§å°ï¼ˆimg_sizeï¼Œäº²æµ‹å•ä½æ˜¯KBï¼‰`ç­‰ä¿¡æ¯ã€‚

### å¼€å§‹å†™ç 

å› ä¸ºæ˜¯**å£çº¸å–µ**ï¼Œæ‰€ä»¥å…ˆç»™ä¸ª`æ–‡ä»¶å¤¹ï¼ˆ./miaoï¼‰`å­˜ä¸€ä¸‹æˆ‘ä»¬çš„å›¾ï¼š

```python
if __name__ == '__main__':  

    dir_path = 'miao/'  
    if not os.path.exists(dir_path):  
        os.mkdir(dir_path)
```

ç„¶åï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†è·å–æˆ‘ä»¬**å›¾ç‰‡jsonå¯¹è±¡**çš„è¯·æ±‚urlï¼Œè€Œæˆ‘ä»¬éœ€è¦åšçš„ä»…ä»…æ˜¯ä¿®æ”¹urlä¸­çš„`page_num`å‚æ•°â€”â€”è€Œä»é¡µé¢å¾—çŸ¥ï¼Œè¿™ä¸ªå‚æ•°çš„å–å€¼æ˜¯0ï½10ï¼Œæ‰€ä»¥ï¼š

```python
page_number = 0  
url_to_get_page = f'https://api.bilibili.com/x/dynamic/feed/draw/doc_list?uid=6823116&page_num={page_number}&page_size=30&biz=all&jsonp=jsonp'
```

æˆ‘ä»¬é€šè¿‡`æ ¼å¼åŒ–å­—ç¬¦ä¸²f-string`å°†å˜é‡åµŒå…¥è¯·æ±‚çš„urlä¸­ï¼Œç„¶åæ¯æ¬¡è¯·æ±‚å®Œè®©å…¶+1â€”â€”è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡**æ„å»º**çš„æ–¹å¼æ¥è·å¾—åç»­urlï¼Œè€Œä¸ç”¨åœ¨htmlé¡µé¢ä¸ŠæŸ¥æ‰¾ï¼Œè¿™è®©æˆ‘ä»¬çš„è®¿é—®æ–¹ä¾¿äº†è®¸å¤šã€‚

ç„¶åçš„äº‹æƒ…æˆ‘ä»¬å°±æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œå…ˆé€šè¿‡**requests**è·å–æ•°æ®ï¼Œç„¶ååœ¨`è¿”å›ä½“ -> data -> items`ä¸­è·å–æˆ‘ä»¬æƒ³è¦çš„å›¾ç‰‡urlï¼Œå†ç”¨**requests**è®¿é—®å›¾ç‰‡urlï¼Œå†™å…¥æœ¬åœ°ã€‚  
å› ä¸ºæˆ‘ä»¬çŸ¥é“è¯·æ±‚è¿”å›çš„æ˜¯JSONæ ¼å¼çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡**requestsä¸­Responseå¯¹è±¡**çš„`json()`æ–¹æ³•ç›´æ¥å°†ç»“æœè½¬ä¸º**JSONå¯¹è±¡**ï¼Œä»è€Œç›´æ¥è·å–å…¶å†…å®¹ï¼š

```python
# only crawl 3 pages  
for current_page in range(3):  
    page_number = current_page  
  
    response_page = requests.get(url_to_get_page)  
    response_page_json = response_page.json()  
    img_list = response_page_json['data']['items']  
  
    # only crawl 5 images in each page  
    for img_index in range(5):  
        for index, pics in enumerate(img_list[img_index]['pictures']):  
            img_name = f'page{page_number}-img{img_index}-{index}.jpg'  
  
            img_url = pics['img_src']  
            img_response = requests.get(img_url)  
  
            with open(f'{dir_path}{img_name}', 'wb') as f:  
                f.write(img_response.content)  
            print(f'download {img_name} successfully')
```

ä¸ºäº†~~çœç‚¹æµé‡~~æ–¹ä¾¿å¿«æ·ï¼Œä¸Šé¢åªçˆ¬å–äº†**å‰ä¸‰é¡µ**çš„å†…å®¹ï¼Œæ¯é¡µåªçˆ¬å–**å‰äº”ä¸ªæŠ•ç¨¿**çš„å›¾ç‰‡ï¼ˆå–µçš„8MBçš„å›¾ç‰‡æˆ‘éƒ½å¾—ä¸‹20ç§’ï¼‰  
å¦‚æœæƒ³è¦çˆ¬å–å…¨éƒ¨é¡µé¢ï¼ˆ10é¡µï¼‰ï¼Œå¯ä»¥æ”¹æˆï¼š`for current_page in range(10):`   
å¦‚æœæƒ³è¦çˆ¬å–ä¸€é¡µçš„å…¨éƒ¨æŠ•ç¨¿å›¾ç‰‡ï¼Œå¯ä»¥ç›´æ¥éå†`img_list`ï¼Œä¸ç”¨åƒä¸Šé¢ç¤ºä¾‹ä¸­ä¸€æ ·åªè·å–å‰äº”ä¸ªæŠ•ç¨¿ï¼š`for img_index in range(5)`  

è¿™ä¸ªçˆ¬è™«åµŒå¥—äº†ä¸‰å±‚å¾ªç¯ï¼Œåˆ†åˆ«å¯¹åº”**éå†å…¨éƒ¨é¡µé¢**ã€**éå†å½“å‰é¡µé¢çš„å…¨éƒ¨æŠ•ç¨¿**ã€**éå†å½“å‰æŠ•ç¨¿çš„å…¨éƒ¨å›¾ç‰‡**ã€‚æ˜¯çš„ï¼Œæ¯ä¸ªæŠ•ç¨¿é‡Œå¯èƒ½è¿˜åŒ…å«å¤šä¸ªå›¾ç‰‡ã€‚  
ç”±äºæˆ‘ä»¬éœ€è¦å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°ï¼Œæ‰€ä»¥è¦ç¡®ä¿æ¯ä¸ªå›¾ç‰‡çš„å‘½åéƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œè¿™é‡Œé‡‡ç”¨`é¡µç -æŠ•ç¨¿çš„å½“å‰é¡µä¸‹æ ‡-å›¾ç‰‡åœ¨æŠ•ç¨¿çš„ä¸‹æ ‡`çš„å½¢å¼ï¼Œæ‰€ä»¥ç”¨åˆ°äº†å†…ç½®å‡½æ•°`enumerate()`æ¥åŒæ—¶éå†ä¸‹æ ‡å’Œæœ¬ä½“ï¼ˆ`for`çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæœ¬ä½“ï¼‰

![downloading](https://media.giphy.com/media/Iqs0WHqVxjSPtJBnvQ/giphy.gif)

### ç­›é€‰å›¾ç‰‡

æˆ‘ä»¬å‘ç°ï¼Œæ¯ä¸ªæŠ•ç¨¿ä¸­éƒ½æœ‰åŒ…å«ç€è®¸å¤šå›¾ç‰‡ï¼Œæœ‰çš„æ˜¯æœ‰ä¸åŒçš„é•¿å®½å°ºå¯¸ï¼Œæ¥ä½œä¸ºæ‰‹æœºæˆ–ç”µè„‘å£çº¸ï¼›è¿˜æœ‰åˆ†ä¸ºæœ‰æ–‡å­—å’Œæ²¡æœ‰æ–‡å­—çš„ç‰ˆæœ¬ç­‰ã€‚  
æ¯”å¦‚æˆ‘ç°åœ¨åªæƒ³è¦ç”µè„‘å£çº¸ï¼Œè¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬å‘ç°åœ¨`data -> items -> pictures`ä¸­ï¼Œæ¯ä¸ª`item`éƒ½åŒ…å«äº†å®½é«˜çš„å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¿›è¡Œåˆ¤æ–­ï¼Œåªä¸‹è½½**å®½åº¦å¤§äºé«˜åº¦**çš„å›¾ç‰‡ï¼š

```python
   for index, pics in enumerate(img_list[img_index]['pictures']):
		img_name = f'page{page_number}-img{img_index}-{index}.jpg'
		# skip if width < height  
		if pics['img_width'] < pics['img_height']:
			print(f'skip {img_name}')
			break

		img_url = pics['img_src']
		img_response = requests.get(img_url)

		with open(f'{dir_path}{img_name}', 'wb') as f:
			f.write(img_response.content)
		print(f'download {img_name} successfully')
```

å½“ç„¶ï¼Œæ¡ä»¶åä¸€ä¸‹ä½ å°±å¯ä»¥åªå¾—åˆ°æ‰‹æœºå£çº¸å•¦

## åè¯

è€æ ·å­ï¼Œä»£ç ä¸Šä¼ åˆ°Githubäº†ï¼š[PythonCrawlerForStudy](https://github.com/BlackDn/PythonCrawlerForStudy)ï¼Œæ”¹è¿›äº†ä¸€ç‚¹ä»£ç ï¼ˆæœ¬æ¥ä¹Ÿä¸å¤šï¼‰ï¼ŒåŠ äº†äº›æ³¨é‡Šå’Œå‚æ•°å•¥çš„ã€‚è¯´å®è¯ä»£ç é‡æ¯”æƒ³è±¡ä¸­çš„è¦å°‘å¾ˆå¤šã€‚  

å…¶å®èƒ½åƒè¿™æ ·æ¯”è¾ƒç®€å•åœ°çˆ¬åˆ°è¿™äº›å›¾ç‰‡å±å®è¿æ°”æ¯”è¾ƒå¥½ï¼Œé¦–å…ˆå’±ä»¬æ²¡é­é‡å•¥åçˆ¬è™«æ‰‹æ®µï¼Œæ²¡æœ‰ç”¨æˆ·çš„cookieè®¤è¯å•¥çš„ï¼›æˆ‘ä»¬è¿˜éå¸¸å¹¸è¿åœ°å‘ç°äº†ç›´æ¥è·å–JSONå¯¹è±¡çš„urlï¼Œä¸ç„¶çš„è¯è¿˜å¾—ä¸€ä¸ªä¸€ä¸ªæŒ‰æŠ•ç¨¿è®¿é—®ï¼Œä¼šéº»çƒ¦å¾ˆå¤šã€‚

äº²æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå¤§æ¦‚15åˆ†é’Ÿä¸‹è½½äº†2é¡µçš„å…¨éƒ¨å›¾ç‰‡ï¼Œå¹¶ä¸”ipæ²¡æœ‰è¢«ç¦ï¼ŒæŒºå¥½çš„ï¼Œæ„Ÿè°¢Bç«™ï¼Œæ„Ÿè°¢å£çº¸å–µğŸ¥°

## å‚è€ƒ
1. [os â€” Miscellaneous operating system interfaces](https://docs.python.org/3/library/os.html)
2. [Linuxæƒé™åŠchmodå‘½ä»¤](https://blackdn.github.io/2020/03/29/Linux-Basic-Tool-2020/#linux%E6%9D%83%E9%99%90%E5%8F%8Achmod%E5%91%BD%E4%BB%A4)
3. [json â€” JSON encoder and decoder](https://docs.python.org/3/library/json.html)